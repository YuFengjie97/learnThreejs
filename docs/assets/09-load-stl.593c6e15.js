import{aA as I,aB as W,m as T,l as R,V as z,K as H,aN as j,G as N,ay as k,a9 as O,f as q,o as X,S as K,C as Y,P as Z,W as $,A as J,a as Q,b as ee}from"./stats.module.1062c650.js";import{O as te}from"./OrbitControls.3104130d.js";import{c as ne}from"./SceneUtils.7c052e71.js";import{d as ae,g as V,h as oe,c as re,f as G,o as se}from"./index.6c251f58.js";class ie extends I{constructor(y){super(y)}load(y,S,M,_){const U=this,F=new W(this.manager);F.setPath(this.path),F.setResponseType("arraybuffer"),F.setRequestHeader(this.requestHeader),F.setWithCredentials(this.withCredentials),F.load(y,function(E){try{S(U.parse(E))}catch(b){_?_(b):console.error(b),U.manager.itemError(y)}},M,_)}parse(y){function S(t){const e=new DataView(t),n=32/8*3+32/8*3*3+16/8,o=e.getUint32(80,!0);if(80+32/8+o*n===e.byteLength)return!0;const i=[115,111,108,105,100];for(let r=0;r<5;r++)if(M(i,e,r))return!1;return!0}function M(t,e,n){for(let o=0,c=t.length;o<c;o++)if(t[o]!==e.getUint8(n+o))return!1;return!0}function _(t){const e=new DataView(t),n=e.getUint32(80,!0);let o,c,i,r=!1,d,m,h,p,l;for(let a=0;a<80-10;a++)e.getUint32(a,!1)==1129270351&&e.getUint8(a+4)==82&&e.getUint8(a+5)==61&&(r=!0,d=new Float32Array(n*3*3),m=e.getUint8(a+6)/255,h=e.getUint8(a+7)/255,p=e.getUint8(a+8)/255,l=e.getUint8(a+9)/255);const L=84,A=12*4+2,u=new T,C=new Float32Array(n*3*3),v=new Float32Array(n*3*3);for(let a=0;a<n;a++){const w=L+a*A,s=e.getFloat32(w,!0),f=e.getFloat32(w+4,!0),B=e.getFloat32(w+8,!0);if(r){const g=e.getUint16(w+48,!0);(g&32768)===0?(o=(g&31)/31,c=(g>>5&31)/31,i=(g>>10&31)/31):(o=m,c=h,i=p)}for(let g=1;g<=3;g++){const P=w+g*12,x=a*3*3+(g-1)*3;C[x]=e.getFloat32(P,!0),C[x+1]=e.getFloat32(P+4,!0),C[x+2]=e.getFloat32(P+8,!0),v[x]=s,v[x+1]=f,v[x+2]=B,r&&(d[x]=o,d[x+1]=c,d[x+2]=i)}}return u.setAttribute("position",new R(C,3)),u.setAttribute("normal",new R(v,3)),r&&(u.setAttribute("color",new R(d,3)),u.hasColors=!0,u.alpha=l),u}function U(t){const e=new T,n=/solid([\s\S]*?)endsolid/g,o=/facet([\s\S]*?)endfacet/g;let c=0;const i=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,r=new RegExp("vertex"+i+i+i,"g"),d=new RegExp("normal"+i+i+i,"g"),m=[],h=[],p=new z;let l,L=0,A=0,u=0;for(;(l=n.exec(t))!==null;){A=u;const C=l[0];for(;(l=o.exec(C))!==null;){let w=0,s=0;const f=l[0];for(;(l=d.exec(f))!==null;)p.x=parseFloat(l[1]),p.y=parseFloat(l[2]),p.z=parseFloat(l[3]),s++;for(;(l=r.exec(f))!==null;)m.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),h.push(p.x,p.y,p.z),w++,u++;s!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+c),w!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+c),c++}const v=A,a=u-A;e.addGroup(v,a,L),L++}return e.setAttribute("position",new H(m,3)),e.setAttribute("normal",new H(h,3)),e}function F(t){return typeof t!="string"?j.decodeText(new Uint8Array(t)):t}function E(t){if(typeof t=="string"){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n)&255;return e.buffer||e}else return t}const b=E(y);return S(b)?_(b):U(F(y))}}const le="/learning-threejs/assets/SolidHead_2_lowPoly_42k.cf92562c.stl",ce={class:"viewCon"},pe=ae({__name:"09-load-stl",setup(D){const{random:y,PI:S,floor:M,ceil:_,min:U,max:F,sin:E,cos:b}=Math,t=V(),e=V();let n=window.innerWidth,o=window.innerHeight,c,i,r,d,m,h;oe(async()=>{p(),v(),C(),await u(),a()});function p(){var f;let s=new N({autoPlace:!1,width:300});s.domElement.style.cssText="position: fixed; top: 0; right: 0;",(f=e.value)==null||f.appendChild(s.domElement)}function l(){h.rotation.y+=.01}const L=new ie;function A(s){return new Promise((f,B)=>{L.load(s,f)})}async function u(){const s=await A(le);s.applyMatrix4(new k().makeScale(.5,.5,.5)),s.applyMatrix4(new k().makeRotationX(-S/2)),s.applyMatrix4(new k().makeTranslation(-30,0,30));const f=new O,B=new q({wireframe:!0});h=ne(s,[f,B]),r.add(h)}function C(){const s=new X(16711680,2);s.position.set(50,50,50),r.add(s)}function v(){r=new K,r.background=new Y(4473924),d=new Z(75,n/o,1,1e3),m=new $({canvas:t.value,antialias:!0}),m.setSize(n,o),window.addEventListener("resize",w),r.add(new J(1e3)),r.add(new Q(4210752)),c=ee(),e.value.append(c.dom),i=new te(d,m.domElement),i.target=new z(0,40,0),i.object.position.set(0,40,100),i.update()}function a(){requestAnimationFrame(a),c.update(),l(),m.render(r,d)}function w(){n=window.innerWidth,o=window.innerHeight,d.aspect=n/o,d.updateProjectionMatrix(),m.setSize(n,o)}return(s,f)=>(se(),re("div",ce,[G("div",{class:"canvasCon",ref_key:"canvasCon",ref:e},[G("canvas",{class:"canvas",ref_key:"canvasDom",ref:t},null,512)],512)]))}});export{pe as default};
