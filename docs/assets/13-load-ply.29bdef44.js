import{C as z,aA as H,aB as N,aN as G,m as M,K as A,G as V,at as F,a1 as W,au as q,aF as D,H as Y,o as O,S as X,P as Z,W as $,A as K,a as J,b as Q,V as ee}from"./stats.module.1062c650.js";import{O as te}from"./OrbitControls.3104130d.js";import{d as ne,g as E,h as se,c as oe,f as R,o as ae,_ as re}from"./index.6c251f58.js";const I=new z;class ie extends H{constructor(h){super(h),this.propertyNameMapping={}}load(h,b,w,x){const _=this,m=new N(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(h,function(f){try{b(_.parse(f))}catch(g){x?x(g):console.error(g),_.manager.itemError(h)}},w,x)}setPropertyNameMapping(h){this.propertyNameMapping=h}parse(h){function b(e){const t=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let n="",o=0;const u=t.exec(e);u!==null&&(n=u[1],o=new Blob([u[0]]).size);const i={comments:[],elements:[],headerLength:o,objInfo:""},d=n.split(/\r\n|\r|\n/);let s;function a(r,c){const l={type:r[0]};return l.type==="list"?(l.name=r[3],l.countType=r[1],l.itemType=r[2]):l.name=r[1],l.name in c&&(l.name=c[l.name]),l}for(let r=0;r<d.length;r++){let c=d[r];if(c=c.trim(),c==="")continue;const l=c.split(/\s+/),L=l.shift();switch(c=l.join(" "),L){case"format":i.format=l[0],i.version=l[1];break;case"comment":i.comments.push(c);break;case"element":s!==void 0&&i.elements.push(s),s={},s.name=l[0],s.count=parseInt(l[1]),s.properties=[];break;case"property":s.properties.push(a(l,P.propertyNameMapping));break;case"obj_info":i.objInfo=c;break;default:console.log("unhandled",L,l)}}return s!==void 0&&i.elements.push(s),i}function w(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function x(e,t){const n=t.split(/\s+/),o={};for(let u=0;u<e.length;u++)if(e[u].type==="list"){const i=[],d=w(n.shift(),e[u].countType);for(let s=0;s<d;s++)i.push(w(n.shift(),e[u].itemType));o[e[u].name]=i}else o[e[u].name]=w(n.shift(),e[u].type);return o}function _(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let o;const u=/end_header\s([\s\S]*)$/;let i="";(o=u.exec(e))!==null&&(i=o[1]);const d=i.split(/\r\n|\r|\n/);let s=0,a=0;for(let r=0;r<d.length;r++){let c=d[r];if(c=c.trim(),c==="")continue;a>=t.elements[s].count&&(s++,a=0);const l=x(t.elements[s].properties,c);f(n,t.elements[s].name,l),a++}return m(n)}function m(e){let t=new M;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new A(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new A(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new A(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new A(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new A(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function f(e,t,n){function o(p){for(let y=0,j=p.length;y<j;y++){const B=p[y];if(B in n)return B}return null}const u=o(["x","px","posx"])||"x",i=o(["y","py","posy"])||"y",d=o(["z","pz","posz"])||"z",s=o(["nx","normalx"]),a=o(["ny","normaly"]),r=o(["nz","normalz"]),c=o(["s","u","texture_u","tx"]),l=o(["t","v","texture_v","ty"]),L=o(["red","diffuse_red","r","diffuse_r"]),T=o(["green","diffuse_green","g","diffuse_g"]),U=o(["blue","diffuse_blue","b","diffuse_b"]);if(t==="vertex")e.vertices.push(n[u],n[i],n[d]),s!==null&&a!==null&&r!==null&&e.normals.push(n[s],n[a],n[r]),c!==null&&l!==null&&e.uvs.push(n[c],n[l]),L!==null&&T!==null&&U!==null&&(I.setRGB(n[L]/255,n[T]/255,n[U]/255).convertSRGBToLinear(),e.colors.push(I.r,I.g,I.b));else if(t==="face"){const p=n.vertex_indices||n.vertex_index,y=n.texcoord;p.length===3?(e.indices.push(p[0],p[1],p[2]),y&&y.length===6&&(e.faceVertexUvs.push(y[0],y[1]),e.faceVertexUvs.push(y[2],y[3]),e.faceVertexUvs.push(y[4],y[5]))):p.length===4&&(e.indices.push(p[0],p[1],p[3]),e.indices.push(p[1],p[2],p[3]))}}function g(e,t,n,o){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,o),2];case"uint16":case"ushort":return[e.getUint16(t,o),2];case"int32":case"int":return[e.getInt32(t,o),4];case"uint32":case"uint":return[e.getUint32(t,o),4];case"float32":case"float":return[e.getFloat32(t,o),4];case"float64":case"double":return[e.getFloat64(t,o),8]}}function v(e,t,n,o){const u={};let i,d=0;for(let s=0;s<n.length;s++)if(n[s].type==="list"){const a=[];i=g(e,t+d,n[s].countType,o);const r=i[0];d+=i[1];for(let c=0;c<r;c++)i=g(e,t+d,n[s].itemType,o),a.push(i[0]),d+=i[1];u[n[s].name]=a}else i=g(e,t+d,n[s].type,o),u[n[s].name]=i[0],d+=i[1];return[u,d]}function C(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},o=t.format==="binary_little_endian",u=new DataView(e,t.headerLength);let i,d=0;for(let s=0;s<t.elements.length;s++)for(let a=0;a<t.elements[s].count;a++){i=v(u,d,t.elements[s].properties,o),d+=i[1];const r=i[0];f(n,t.elements[s].name,r)}return m(n)}let S;const P=this;if(h instanceof ArrayBuffer){const e=G.decodeText(new Uint8Array(h)),t=b(e);S=t.format==="ascii"?_(e,t):C(h,t)}else S=_(h,b(h));return S}}const ce="/learning-threejs/assets/car.f49392df.ply",le={class:"viewCon"},ue=ne({__name:"13-load-ply",setup(k){const h=E(),b=E();let w=window.innerWidth,x=window.innerHeight,_,m,f,g,v,C;se(async()=>{S(),i(),u(),await n(),d()});function S(){var r;let a=new V({autoPlace:!1,width:300});a.domElement.style.cssText="position: fixed; top: 0; right: 0;",(r=b.value)==null||r.appendChild(a.domElement)}function P(){C.rotation.y+=.01}const e=new ie;function t(a){return new Promise((r,c)=>{e.load(a,r)})}async function n(){const a=await t(ce),r=new F({color:16777215,size:6,depthTest:!1,transparent:!0,blending:W,map:o()});C=new q(a,r),C.scale.multiplyScalar(30),f.add(C)}function o(){const a=document.createElement("canvas");a.width=16,a.height=16;const r=a.getContext("2d"),c=r.createRadialGradient(a.width/2,a.height/2,0,a.width/2,a.height/2,a.width/2);c.addColorStop(0,"rgba(255,255,255,1)"),c.addColorStop(.2,"rgba(0,255,255,1)"),c.addColorStop(.4,"rgba(0,0,64,1)"),c.addColorStop(1,"rgba(0,0,0,1)"),r.fillStyle=c,r.fillRect(0,0,a.width,a.height);const l=new D(a);return l.needsUpdate=!0,l}function u(){const a=new Y(16777215,0,1);f.add(a);const r=new O(16711680,2);r.position.set(50,50,50),f.add(r)}function i(){f=new X,f.background=new z(4473924),g=new Z(75,w/x,1,1e3),v=new $({canvas:h.value,antialias:!0}),v.setSize(w,x),v.shadowMap.enabled=!0,v.setPixelRatio(window.devicePixelRatio),f.add(new K(1e3)),f.add(new J(4210752)),_=Q(),b.value.append(_.dom),m=new te(g,v.domElement),m.target=new ee(0,0,0),m.object.position.set(0,0,400),m.update()}function d(){requestAnimationFrame(d),_.update(),P(),v.render(f,g)}window.addEventListener("resize",s);function s(){w=window.innerWidth,x=window.innerHeight,g.aspect=w/x,g.updateProjectionMatrix(),v.setSize(w,x)}return(a,r)=>(ae(),oe("div",le,[R("div",{class:"canvasCon",ref_key:"canvasCon",ref:b},[R("canvas",{class:"canvas",ref_key:"canvasDom",ref:h},null,512)],512)]))}});const me=re(ue,[["__scopeId","data-v-d5d3c067"]]);export{me as default};
