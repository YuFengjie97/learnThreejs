import{aA as we,aB as Ae,aN as Q,m as Z,K as X,l as Y,G as ye,ay as ve,i as me,f as xe,H as be,o as ge,S as Ie,C as Se,P as Fe,W as Oe,A as Ce,a as Pe,b as Te,V as De}from"./stats.module.c456474f.js";import{O as Le}from"./OrbitControls.ff4b382f.js";import{c as Ne}from"./SceneUtils.60b9f24d.js";import{d as ke,g as ie,h as Ue,c as _e,f as oe,o as Ee}from"./index.b9f501be.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var le=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(le(""))}catch{le=function(s){return"data:application/javascript;charset=UTF-8,"+encodeURI(s)}}var G=Uint8Array,W=Uint16Array,te=Uint32Array,ce=new G([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fe=new G([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Re=new G([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ue=function(t,s){for(var o=new W(31),m=0;m<31;++m)o[m]=s+=1<<t[m-1];for(var p=new te(o[30]),m=1;m<30;++m)for(var N=o[m];N<o[m+1];++N)p[N]=N-o[m]<<5|m;return[o,p]},pe=ue(ce,2),de=pe[0],je=pe[1];de[28]=258,je[258]=28;var ze=ue(fe,0),Me=ze[0],ne=new W(32768);for(var k=0;k<32768;++k){var H=(k&43690)>>>1|(k&21845)<<1;H=(H&52428)>>>2|(H&13107)<<2,H=(H&61680)>>>4|(H&3855)<<4,ne[k]=((H&65280)>>>8|(H&255)<<8)>>>1}var q=function(t,s,o){for(var m=t.length,p=0,N=new W(s);p<m;++p)++N[t[p]-1];var _=new W(s);for(p=0;p<s;++p)_[p]=_[p-1]+N[p-1]<<1;var U;if(o){U=new W(1<<s);var l=15-s;for(p=0;p<m;++p)if(t[p])for(var c=p<<4|t[p],y=s-t[p],I=_[t[p]-1]++<<y,E=I|(1<<y)-1;I<=E;++I)U[ne[I]>>>l]=c}else for(U=new W(m),p=0;p<m;++p)t[p]&&(U[p]=ne[_[t[p]-1]++]>>>15-t[p]);return U},K=new G(288);for(var k=0;k<144;++k)K[k]=8;for(var k=144;k<256;++k)K[k]=9;for(var k=256;k<280;++k)K[k]=7;for(var k=280;k<288;++k)K[k]=8;var he=new G(32);for(var k=0;k<32;++k)he[k]=5;var Be=q(K,9,1),Ge=q(he,5,1),$=function(t){for(var s=t[0],o=1;o<t.length;++o)t[o]>s&&(s=t[o]);return s},V=function(t,s,o){var m=s/8|0;return(t[m]|t[m+1]<<8)>>(s&7)&o},ee=function(t,s){var o=s/8|0;return(t[o]|t[o+1]<<8|t[o+2]<<16)>>(s&7)},Ve=function(t){return(t/8|0)+(t&7&&1)},He=function(t,s,o){(s==null||s<0)&&(s=0),(o==null||o>t.length)&&(o=t.length);var m=new(t instanceof W?W:t instanceof te?te:G)(o-s);return m.set(t.subarray(s,o)),m},We=function(t,s,o){var m=t.length;if(!m||o&&!o.l&&m<5)return s||new G(0);var p=!s||o,N=!o||o.i;o||(o={}),s||(s=new G(m*3));var _=function(re){var ae=s.length;if(re>ae){var se=new G(Math.max(ae*2,re));se.set(s),s=se}},U=o.f||0,l=o.p||0,c=o.b||0,y=o.l,I=o.d,E=o.m,w=o.n,R=m*8;do{if(!y){o.f=U=V(t,l,1);var j=V(t,l+1,3);if(l+=3,j)if(j==1)y=Be,I=Ge,E=9,w=5;else if(j==2){var f=V(t,l,31)+257,a=V(t,l+10,15)+4,n=f+V(t,l+5,31)+1;l+=14;for(var e=new G(n),h=new G(19),i=0;i<a;++i)h[Re[i]]=V(t,l+i*3,7);l+=a*3;for(var S=$(h),v=(1<<S)-1,u=q(h,S,1),i=0;i<n;){var D=u[V(t,l,v)];l+=D&15;var x=D>>>4;if(x<16)e[i++]=x;else{var b=0,T=0;for(x==16?(T=3+V(t,l,3),l+=2,b=e[i-1]):x==17?(T=3+V(t,l,7),l+=3):x==18&&(T=11+V(t,l,127),l+=7);T--;)e[i++]=b}}var z=e.subarray(0,f),O=e.subarray(f);E=$(z),w=$(O),y=q(z,E,1),I=q(O,w,1)}else throw"invalid block type";else{var x=Ve(l)+4,F=t[x-4]|t[x-3]<<8,r=x+F;if(r>m){if(N)throw"unexpected EOF";break}p&&_(c+F),s.set(t.subarray(x,r),c),o.b=c+=F,o.p=l=r*8;continue}if(l>R){if(N)throw"unexpected EOF";break}}p&&_(c+131072);for(var C=(1<<E)-1,g=(1<<w)-1,A=l;;A=l){var b=y[ee(t,l)&C],d=b>>>4;if(l+=b&15,l>R){if(N)throw"unexpected EOF";break}if(!b)throw"invalid length/literal";if(d<256)s[c++]=d;else if(d==256){A=l,y=null;break}else{var P=d-254;if(d>264){var i=d-257,L=ce[i];P=V(t,l,(1<<L)-1)+de[i],l+=L}var B=I[ee(t,l)&g],M=B>>>4;if(!B)throw"invalid distance";l+=B&15;var O=Me[M];if(M>3){var L=fe[M];O+=ee(t,l)&(1<<L)-1,l+=L}if(l>R){if(N)throw"unexpected EOF";break}p&&_(c+131072);for(var J=c+P;c<J;c+=4)s[c]=s[c-O],s[c+1]=s[c+1-O],s[c+2]=s[c+2-O],s[c+3]=s[c+3-O];c=J}}o.l=y,o.p=A,o.b=c,y&&(U=1,o.m=E,o.d=I,o.n=w)}while(!U);return c==s.length?s:He(s,0,c)},Ye=new G(0),qe=function(t){if((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(t[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Ke(t,s){return We((qe(t),t.subarray(2,-4)),s)}var Je=typeof TextDecoder<"u"&&new TextDecoder,Xe=0;try{Je.decode(Ye,{stream:!0}),Xe=1}catch{}class Qe extends we{constructor(s){super(s)}load(s,o,m,p){const N=this,_=new Ae(N.manager);_.setPath(N.path),_.setResponseType("arraybuffer"),_.setRequestHeader(N.requestHeader),_.setWithCredentials(N.withCredentials),_.load(s,function(U){try{o(N.parse(U))}catch(l){p?p(l):console.error(l),N.manager.itemError(s)}},m,p)}parse(s){function o(l){const c=[],y=[],I=[],E=[];let w;const R=/^[^\d.\s-]+/,j=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,x=/^(\d+)\s+([\s\d]*)/,F=/^POINTS /,r=/^POLYGONS /,f=/^TRIANGLE_STRIPS /,a=/^POINT_DATA[ ]+(\d+)/,n=/^CELL_DATA[ ]+(\d+)/,e=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,h=/^NORMALS[ ]+(\w+)[ ]+(\w+)/;let i=!1,S=!1,v=!1,u=!1,D=!1,b=!1,T=!1;const z=l.split(`
`);for(const C in z){const g=z[C].trim();if(g.indexOf("DATASET")===0){const A=g.split(" ")[1];if(A!=="POLYDATA")throw new Error("Unsupported DATASET type: "+A)}else if(i)for(;(w=j.exec(g))!==null&&R.exec(g)===null;){const A=parseFloat(w[1]),d=parseFloat(w[2]),P=parseFloat(w[3]);y.push(A,d,P)}else if(S){if((w=x.exec(g))!==null){const A=parseInt(w[1]),d=w[2].split(/\s+/);if(A>=3){const P=parseInt(d[0]);let L=1;for(let B=0;B<A-2;++B){const M=parseInt(d[L]),J=parseInt(d[L+1]);c.push(P,M,J),L++}}}}else if(v){if((w=x.exec(g))!==null){const A=parseInt(w[1]),d=w[2].split(/\s+/);if(A>=3)for(let P=0;P<A-2;P++)if(P%2===1){const L=parseInt(d[P]),B=parseInt(d[P+2]),M=parseInt(d[P+1]);c.push(L,B,M)}else{const L=parseInt(d[P]),B=parseInt(d[P+1]),M=parseInt(d[P+2]);c.push(L,B,M)}}}else if(u||D){if(b)for(;(w=j.exec(g))!==null&&R.exec(g)===null;){const A=parseFloat(w[1]),d=parseFloat(w[2]),P=parseFloat(w[3]);I.push(A,d,P)}else if(T)for(;(w=j.exec(g))!==null&&R.exec(g)===null;){const A=parseFloat(w[1]),d=parseFloat(w[2]),P=parseFloat(w[3]);E.push(A,d,P)}}r.exec(g)!==null?(S=!0,i=!1,v=!1):F.exec(g)!==null?(S=!1,i=!0,v=!1):f.exec(g)!==null?(S=!1,i=!1,v=!0):a.exec(g)!==null?(u=!0,i=!1,S=!1,v=!1):n.exec(g)!==null?(D=!0,i=!1,S=!1,v=!1):e.exec(g)!==null?(b=!0,T=!1,i=!1,S=!1,v=!1):h.exec(g)!==null&&(T=!0,b=!1,i=!1,S=!1,v=!1)}let O=new Z;if(O.setIndex(c),O.setAttribute("position",new X(y,3)),E.length===y.length&&O.setAttribute("normal",new X(E,3)),I.length!==c.length)I.length===y.length&&O.setAttribute("color",new X(I,3));else{O=O.toNonIndexed();const C=O.attributes.position.count/3;if(I.length===C*3){const g=[];for(let A=0;A<C;A++){const d=I[3*A+0],P=I[3*A+1],L=I[3*A+2];g.push(d,P,L),g.push(d,P,L),g.push(d,P,L)}O.setAttribute("color",new X(g,3))}}return O}function m(l){const c=new Uint8Array(l),y=new DataView(l);let I=[],E=[],w=[],R=0;function j(f,a){let n=a,e=f[n];const h=[];for(;e!==10;)h.push(String.fromCharCode(e)),n++,e=f[n];return{start:a,end:n,next:n+1,parsedString:h.join("")}}let x,F;for(;;){if(x=j(c,R),F=x.parsedString,F.indexOf("DATASET")===0){const f=F.split(" ")[1];if(f!=="POLYDATA")throw new Error("Unsupported DATASET type: "+f)}else if(F.indexOf("POINTS")===0){const f=parseInt(F.split(" ")[1],10),a=f*4*3;I=new Float32Array(f*3);let n=x.next;for(let e=0;e<f;e++)I[3*e]=y.getFloat32(n,!1),I[3*e+1]=y.getFloat32(n+4,!1),I[3*e+2]=y.getFloat32(n+8,!1),n=n+12;x.next=x.next+a+1}else if(F.indexOf("TRIANGLE_STRIPS")===0){const f=parseInt(F.split(" ")[1],10),a=parseInt(F.split(" ")[2],10),n=a*4;w=new Uint32Array(3*a-9*f);let e=0,h=x.next;for(let i=0;i<f;i++){const S=y.getInt32(h,!1),v=[];h+=4;for(let u=0;u<S;u++)v.push(y.getInt32(h,!1)),h+=4;for(let u=0;u<S-2;u++)u%2?(w[e++]=v[u],w[e++]=v[u+2],w[e++]=v[u+1]):(w[e++]=v[u],w[e++]=v[u+1],w[e++]=v[u+2])}x.next=x.next+n+1}else if(F.indexOf("POLYGONS")===0){const f=parseInt(F.split(" ")[1],10),a=parseInt(F.split(" ")[2],10),n=a*4;w=new Uint32Array(3*a-9*f);let e=0,h=x.next;for(let i=0;i<f;i++){const S=y.getInt32(h,!1),v=[];h+=4;for(let u=0;u<S;u++)v.push(y.getInt32(h,!1)),h+=4;for(let u=1;u<S-1;u++)w[e++]=v[0],w[e++]=v[u],w[e++]=v[u+1]}x.next=x.next+n+1}else if(F.indexOf("POINT_DATA")===0){const f=parseInt(F.split(" ")[1],10);x=j(c,x.next);const a=f*4*3;E=new Float32Array(f*3);let n=x.next;for(let e=0;e<f;e++)E[3*e]=y.getFloat32(n,!1),E[3*e+1]=y.getFloat32(n+4,!1),E[3*e+2]=y.getFloat32(n+8,!1),n+=12;x.next=x.next+a}if(R=x.next,R>=c.byteLength)break}const r=new Z;return r.setIndex(new Y(w,1)),r.setAttribute("position",new Y(I,3)),E.length===I.length&&r.setAttribute("normal",new Y(E,3)),r}function p(l,c){const y=l.length,I=new Float32Array(y+c.length);return I.set(l),I.set(c,y),I}function N(l,c){const y=l.length,I=new Int32Array(y+c.length);return I.set(l),I.set(c,y),I}function _(l){function c(r){let f={};if(r.nodeType===1){if(r.attributes&&r.attributes.length>0){f.attributes={};for(let a=0;a<r.attributes.length;a++){const n=r.attributes.item(a);f.attributes[n.nodeName]=n.nodeValue.trim()}}}else r.nodeType===3&&(f=r.nodeValue.trim());if(r.hasChildNodes())for(let a=0;a<r.childNodes.length;a++){const n=r.childNodes.item(a),e=n.nodeName;if(typeof f[e]>"u"){const h=c(n);h!==""&&(f[e]=h)}else{if(typeof f[e].push>"u"){const i=f[e];f[e]=[i]}const h=c(n);h!==""&&f[e].push(h)}}return f}function y(r){const f=typeof Uint8Array<"u"?Uint8Array:Array,a=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let b=0,T=n.length;b<T;++b)a[n.charCodeAt(b)]=b;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63;const e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");const h=r[e-2]==="="?2:r[e-1]==="="?1:0,i=new f(e*3/4-h),S=h>0?e-4:e;let v=0,u,D;for(u=0,D=0;u<S;u+=4,D+=3){const b=a[r.charCodeAt(u)]<<18|a[r.charCodeAt(u+1)]<<12|a[r.charCodeAt(u+2)]<<6|a[r.charCodeAt(u+3)];i[v++]=(b&16711680)>>16,i[v++]=(b&65280)>>8,i[v++]=b&255}if(h===2){const b=a[r.charCodeAt(u)]<<2|a[r.charCodeAt(u+1)]>>4;i[v++]=b&255}else if(h===1){const b=a[r.charCodeAt(u)]<<10|a[r.charCodeAt(u+1)]<<4|a[r.charCodeAt(u+2)]>>2;i[v++]=b>>8&255,i[v++]=b&255}return i}function I(r,f){let a=0;R.attributes.header_type==="UInt64"?a=8:R.attributes.header_type==="UInt32"&&(a=4);let n,e;if(r.attributes.format==="binary"&&f){r.attributes.type==="Float32"?n=new Float32Array:(r.attributes.type==="Int32"||r.attributes.type==="Int64")&&(n=new Int32Array);const h=r["#text"],i=Array.isArray(h)?h[0]:h,S=y(i),v=8;let u=S[0];for(let C=1;C<a-1;C++)u=u|S[C]<<C*v;let D=(u+3)*a;const b=D%3>0?3-D%3:0;D=D+b;const T=[];let z=D;T.push(z);const O=3*a;for(let C=0;C<u;C++){let g=S[C*a+O];for(let A=1;A<a-1;A++)g=g|S[C*a+O+A]<<A*v;z=z+g,T.push(z)}for(let C=0;C<T.length-1;C++)e=Ke(S.slice(T[C],T[C+1])).buffer,r.attributes.type==="Float32"?(e=new Float32Array(e),n=p(n,e)):(r.attributes.type==="Int32"||r.attributes.type==="Int64")&&(e=new Int32Array(e),n=N(n,e));delete r["#text"],r.attributes.type==="Int64"&&r.attributes.format==="binary"&&(n=n.filter(function(C,g){if(g%2!==1)return!0}))}else r.attributes.format==="binary"&&!f?(e=y(r["#text"]),e=e.slice(a).buffer):r["#text"]?e=r["#text"].split(/\s+/).filter(function(h){if(h!=="")return h}):e=new Int32Array(0).buffer,delete r["#text"],r.attributes.type==="Float32"?n=new Float32Array(e):r.attributes.type==="Int32"?n=new Int32Array(e):r.attributes.type==="Int64"&&(n=new Int32Array(e),r.attributes.format==="binary"&&(n=n.filter(function(h,i){if(i%2!==1)return!0})));return n}const w=new DOMParser().parseFromString(l,"application/xml").documentElement,R=c(w);let j=[],x=[],F=[];if(R.PolyData){const r=R.PolyData.Piece,f=R.attributes.hasOwnProperty("compressor"),a=["PointData","Points","Strips","Polys"];let n=0;const e=a.length;for(;n<e;){const i=r[a[n]];if(i&&i.DataArray){let S;Array.isArray(i.DataArray)?S=i.DataArray:S=[i.DataArray];let v=0;const u=S.length;for(;v<u;)"#text"in S[v]&&S[v]["#text"].length>0&&(S[v].text=I(S[v],f)),v++;switch(a[n]){case"PointData":{const D=parseInt(r.attributes.NumberOfPoints),b=i.attributes.Normals;if(D>0){for(let T=0,z=S.length;T<z;T++)if(b===S[T].attributes.Name){const O=S[T].attributes.NumberOfComponents;x=new Float32Array(D*O),x.set(S[T].text,0)}}}break;case"Points":{const D=parseInt(r.attributes.NumberOfPoints);if(D>0){const b=i.DataArray.attributes.NumberOfComponents;j=new Float32Array(D*b),j.set(i.DataArray.text,0)}}break;case"Strips":{const D=parseInt(r.attributes.NumberOfStrips);if(D>0){const b=new Int32Array(i.DataArray[0].text.length),T=new Int32Array(i.DataArray[1].text.length);b.set(i.DataArray[0].text,0),T.set(i.DataArray[1].text,0);const z=D+b.length;F=new Uint32Array(3*z-9*D);let O=0;for(let C=0,g=D;C<g;C++){const A=[];for(let d=0,P=T[C],L=0;d<P-L;d++)A.push(b[d]),C>0&&(L=T[C-1]);for(let d=0,P=T[C],L=0;d<P-L-2;d++)d%2?(F[O++]=A[d],F[O++]=A[d+2],F[O++]=A[d+1]):(F[O++]=A[d],F[O++]=A[d+1],F[O++]=A[d+2]),C>0&&(L=T[C-1])}}}break;case"Polys":{const D=parseInt(r.attributes.NumberOfPolys);if(D>0){const b=new Int32Array(i.DataArray[0].text.length),T=new Int32Array(i.DataArray[1].text.length);b.set(i.DataArray[0].text,0),T.set(i.DataArray[1].text,0);const z=D+b.length;F=new Uint32Array(3*z-9*D);let O=0,C=0,g=0,A=0;const d=D;for(;g<d;){const P=[];let L=0;const B=T[g];for(;L<B-A;)P.push(b[C++]),L++;let M=1;for(;M<B-A-1;)F[O++]=P[0],F[O++]=P[M],F[O++]=P[M+1],M++;g++,A=T[g-1]}}}break}}n++}const h=new Z;return h.setIndex(new Y(F,1)),h.setAttribute("position",new Y(j,3)),x.length===j.length&&h.setAttribute("normal",new Y(x,3)),h}else throw new Error("Unsupported DATASET type")}const U=Q.decodeText(new Uint8Array(s,0,250)).split(`
`);return U[0].indexOf("xml")!==-1?_(Q.decodeText(s)):U[2].includes("ASCII")?o(Q.decodeText(s)):m(s)}}const Ze="/learning-threejs/assets/moai_fixed.40f4119c.vtk",$e={class:"viewCon"},at=ke({__name:"11-load-vtk",setup(t){const s=ie(),o=ie();let m=window.innerWidth,p=window.innerHeight,N,_,U,l,c,y;Ue(async()=>{I(),F(),x(),await j(),r()});function I(){var n;let a=new ye({autoPlace:!1,width:300});a.domElement.style.cssText="position: fixed; top: 0; right: 0;",(n=o.value)==null||n.appendChild(a.domElement)}function E(){y.rotation.y+=.01}const w=new Qe;function R(a){return new Promise((n,e)=>{w.load(a,n)})}async function j(){const a=await R(Ze);a.applyMatrix4(new ve().makeTranslation(0,1,0));const n=new me({color:10656766}),e=new xe({wireframe:!0});y=Ne(a,[n,e]),y.scale.multiplyScalar(55),U.add(y)}function x(){const a=new be(16777215,0,1);U.add(a);const n=new ge(16711680,2);n.position.set(50,50,50),U.add(n)}function F(){U=new Ie,U.background=new Se(4473924),l=new Fe(75,m/p,1,1e3),c=new Oe({canvas:s.value,antialias:!0}),c.setSize(m,p),c.shadowMap.enabled=!0,c.setPixelRatio(window.devicePixelRatio),window.addEventListener("resize",f),U.add(new Ce(1e3)),U.add(new Pe(4210752)),N=Te(),o.value.append(N.dom),_=new Le(l,c.domElement),_.target=new De(0,40,0),_.object.position.set(0,40,100),_.update()}function r(){requestAnimationFrame(r),N.update(),E(),c.render(U,l)}function f(){m=window.innerWidth,p=window.innerHeight,l.aspect=m/p,l.updateProjectionMatrix(),c.setSize(m,p)}return(a,n)=>(Ee(),_e("div",$e,[oe("div",{class:"canvasCon",ref_key:"canvasCon",ref:o},[oe("canvas",{class:"canvas",ref_key:"canvasDom",ref:s},null,512)],512)]))}});export{at as default};
