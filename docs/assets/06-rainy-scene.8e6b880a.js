var T=Object.defineProperty;var W=(i,t,r)=>t in i?T(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r;var f=(i,t,r)=>(W(i,typeof t!="symbol"?t+"":t,r),r);import{m as k,s as N,at as j,a1 as D,G as U,l as V,au as F,S as O,P as q,W as $,A as J,a as K,b as Q,V as X}from"./stats.module.c456474f.js";import{O as Y}from"./OrbitControls.ff4b382f.js";import{d as Z,g as z,h as ee,c as ne,f as P,o as te}from"./index.b9f501be.js";const ae="/learning-threejs/assets/raindrop-3.0e85d730.png",se={class:"viewCon"},we=Z({__name:"06-rainy-scene",setup(i){const{random:t,PI:r,floor:oe,ceil:ie,min:re,max:de,sin:ce,cos:le}=Math,x=z(),v=z();let d=window.innerWidth,c=window.innerHeight,y,h,l,u,p;const C=1e4,o=new Float32Array(C*3),w=new k,A=new N().load(ae),g=new j({size:20,color:7649791,map:A,transparent:!0,opacity:1,depthTest:!1,blending:D});let I;const _=[],m=2e3;ee(()=>{E(),H(),G(),b()});const s={g:.1,stop:!1,color:7649791,size:20,opacity:1,rainNum:1e4};function E(){var n;let e=new U({autoPlace:!1,width:300});e.domElement.style.cssText="position: fixed; top: 0; right: 0;",(n=v.value)==null||n.appendChild(e.domElement),e.add(s,"g",.01,.2,.001).name("gravity"),e.add(s,"stop"),e.add(s,"rainNum",0,1e4,1).onChange(a=>w.setDrawRange(0,a)),e.addColor(s,"color").onChange(a=>g.color.setHex(a)),e.add(s,"size",.1,30,.1).onChange(a=>g.size=a),e.add(s,"opacity",.1,1,.1).onChange(a=>g.opacity=a)}class R{constructor(n,a,S){f(this,"xInd");f(this,"yInd");f(this,"zInd");f(this,"vel",t());this.xInd=n,this.yInd=a,this.zInd=S}update(){this.vel+=s.g,o[this.yInd]-=this.vel}edge(){o[this.yInd]<-m/2&&(o[this.yInd]=t()*-.5*m+m,this.vel=t())}}function B(){s.stop||L()}function G(){const e=()=>t()*m-m/2;for(let n=0;n<C;n++){o[n*3]=e(),o[n*3+1]=e(),o[n*3+2]=e();const a=new R(n*3,n*3+1,n*3+2);_.push(a)}w.setAttribute("position",new V(o,3)),I=new F(w,g),l.add(I)}function L(){_.forEach(e=>{e.edge(),e.update()}),w.attributes.position.needsUpdate=!0}function H(){l=new O,u=new q(75,d/c,1,1e3),p=new $({canvas:x.value,antialias:!0}),p.setSize(d,c),window.addEventListener("resize",M),l.add(new J(1e3)),l.add(new K(4210752)),y=Q(),v.value.append(y.dom),h=new Y(u,p.domElement),h.object.position.set(0,0,600),h.target=new X(0,0,0),h.update()}function b(){requestAnimationFrame(b),y.update(),B(),p.render(l,u)}function M(){d=window.innerWidth,c=window.innerHeight,u.aspect=d/c,u.updateProjectionMatrix(),p.setSize(d,c)}return(e,n)=>(te(),ne("div",se,[P("div",{class:"canvasCon",ref_key:"canvasCon",ref:v},[P("canvas",{class:"canvas",ref_key:"canvasDom",ref:x},null,512)],512)]))}});export{we as default};
